<!DOCTYPE html>
<html>

<link href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" rel="stylesheet" type="text/css">
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>


<head>
    <meta charset="UTF-8">
    <title>BTC Order Book Depth</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #111;
            color: #eee;
            padding: 120px;
        }

        h2 {
            text-align: center;
            margin-bottom: 80px;
            font-size: 180px; /* Ê†áÈ¢òÊõ¥Â§ß */
        }

        .orderbook {
            display: flex;
            justify-content: center;
            gap: 120px; /* ‰∏§ËæπË°®Ê†ºÈó¥Ë∑ùÊõ¥Â§ß */
        }

        table {
            border-collapse: collapse;
            width: 1800px;
            background: #222;
            color: #eee;
            font-size: 32px;
        }

        th, td {
            padding: 64px;
            text-align: center; /* üëà Â±Ö‰∏≠ÂØπÈΩê */
        }

        th {
            background: #333;
            font-size: 100px;
        }

        td {
            font-size: 60px; /* üëà Êï∞ÊçÆÊõ¥Â§ßÔºåÁúãÁùÄÈÜíÁõÆ */
            font-weight: bold;
        }

        tr.ask {
            background-color: rgba(255, 0, 0, 0.25);
        }

        tr.bid {
            background-color: rgba(0, 255, 0, 0.25);
        }


        /* ‰∏ãÂçïË°®Âçï */
        .order-form {
            width: 2000px;
            margin: 0 auto;
            padding: 80px;
            background: #1c1c1c;
            border-radius: 40px;
            font-size: 70px;
        }

        .order-form label {
            display: block;
            margin-top: 50px;
            margin-bottom: 40px;
        }

        .order-form input {
            width: 100%;
            padding: 24px;
            font-size: 50px;
            border: 1px solid #444;
            border-radius: 6px;
            background: #222;
            color: #fff;
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 90px;
        }

        .buy-btn, .sell-btn {
            flex: 1;
            padding: 95px;
            margin: 0 5px;
            border: none;
            border-radius: 6px;
            font-size: 90px;
            cursor: pointer;
            color: white;
        }

        .buy-btn {
            background: #16a34a;
        }

        .sell-btn {
            background: #dc2626;
        }

        .buy-btn:hover {
            background: #22c55e;
        }

        .sell-btn:hover {
            background: #ef4444;
        }


    </style>
</head>
<body>
<h2>BTC Order Book Depth (Live)</h2>
<div class="orderbook">
    <div>
        <h2 style="text-align:center;">Bids (‰π∞Áõò)</h2>
        <table id="bidsTable">
            <thead>
            <tr>
                <th>Price</th>
                <th>Qty</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div>
        <h2 style="text-align:center;">Asks (ÂçñÁõò)</h2>
        <table id="asksTable">
            <thead>
            <tr>
                <h3>
                    <th>Price</th>
                    <th>Qty</th>
                </h3>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div class="order-form">
    <div class="order-inputs">
        <label>‰ª∑Ê†º</label>
        <input id="price" placeholder="ËæìÂÖ•‰ª∑Ê†º" type="number"/>
        <label>Êï∞Èáè</label>
        <input id="qty" placeholder="ËæìÂÖ•Êï∞Èáè" type="number"/>
    </div>

    <div class="order-buttons">
        <button class="buy-btn" onclick="placeOrder('BID')">‰π∞ÂÖ•</button>
        <button class="sell-btn" onclick="placeOrder('ASK')">ÂçñÂá∫</button>
    </div>
</div>

<script>
    const ws = new WebSocket("ws://localhost:8080/ws/depth");

    ws.onmessage = e => {
        const arr = JSON.parse(e.data);
        const bids = arr[0];
        const asks = arr[1];

        renderTable("bidsTable", bids, "bid", false); // ‰π∞ÁõòÈôçÂ∫è
        renderTable("asksTable", asks, "ask", true);  // ÂçñÁõòÂçáÂ∫è
    };

    function renderTable(tableId, obj, rowClass, asc) {
        const tbody = document.getElementById(tableId).querySelector("tbody");
        tbody.innerHTML = "";

        // ËΩ¨Êç¢Êàê [price, qty] Êï∞ÁªÑ
        let rows = Object.entries(obj).map(([price, qty]) => [parseFloat(price), qty]);

        // ÊéíÂ∫è
        rows.sort((a, b) => asc ? a[0] - b[0] : b[0] - a[0]);

        rows.forEach(([price, qty]) => {
            const tr = document.createElement("tr");
            tr.className = rowClass;
            tr.innerHTML = `<td>${price}</td><td>${qty}</td>`;
            tbody.appendChild(tr);
        });
    }

    async function placeOrder(side) {
        const price = document.getElementById("price").value;
        const qty = document.getElementById("qty").value;

        if (!price || !qty) {
            alert("ËØ∑ËæìÂÖ•‰ª∑Ê†ºÂíåÊï∞Èáè");
            return;
        }
        try {
            const res = await fetch("http://localhost:8080/api/order", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    userId: 1,
                    orderId: Math.round(Math.random() * 1000),
                    symbol: "BTCUSDT",
                    type: "LIMIT",
                    tif: "GTC",
                    side: side,   // "buy" Êàñ "sell"
                    price: price,
                    origQty: qty
                })
            });

            if (res.ok) {
                alert(`‰∏ãÂçïÊàêÂäü: ${side.toUpperCase()} ${qty} @ ${price}`);
            } else {
                alert("‰∏ãÂçïÂ§±Ë¥•");
            }
        } catch (err) {
            alert("ËØ∑Ê±ÇÈîôËØØ: " + err.message);
        }
    }
</script>
</body>
</html>
