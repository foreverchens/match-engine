<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>U 形环形数组 + 单元 Head…Mid…Tail 引用（基于 X 轴对称）</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #fafafa;
            font-family: sans-serif;
        }

        svg {
            display: block;
            width: 100%;
            height: 100%;
            background: #fff;
        }

        .segment {
            fill: #e0e0e0;
            stroke: #fff;
            stroke-width: 2;
        }

        .label {
            font-size: 12px;
            fill: #333;
            text-anchor: middle;
            alignment-baseline: middle;
            pointer-events: none;
        }

        .pointer {
            stroke: #666;
            stroke-width: 2;
            marker-end: url(#smallArrow);
        }

        .dll-node {
            fill: #87cefa;
            stroke: #4682b4;
            stroke-width: 1;
        }

        .dll-text {
            font-size: 10px;
            fill: #23527c;
            text-anchor: middle;
            alignment-baseline: middle;
            pointer-events: none;
        }
    </style>
</head>
<body>
<svg id="canvas" viewBox="0 0 600 600">
    <defs>
        <marker id="smallArrow" markerHeight="4" markerUnits="strokeWidth" markerWidth="4" orient="auto" refX="3"
                refY="2">
            <path d="M0,0 L4,2 L0,4 Z" fill="#666"/>
        </marker>
    </defs>
    <!-- 基于 X 轴对称 & 缩放 80% -->
    <g transform="translate(0,500) scale(0.64,-0.64) rotate(-20 250 250)">
        <script>
            (() => {
                const svg = document.currentScript.ownerDocument.getElementById("canvas");
                const cx = 150, cy = 350;
                const rOuter = 150, rInner = 100;
                const count = 11, startPrice = 94;
                const totalAngle = 3 * Math.PI / 3;
                const angleStep = totalAngle / count;
                // 开口范围准确对称于 X 轴中心方向
                const startAngle = 3 * Math.PI / 2 - angleStep;

                const nodeRadius = 8;
                const offset1 = 88 * 0.7;
                const h2mLen = 50 * 0.8;
                const m2tLen = 50 * 0.8;

                for (let i = 0; i < count; i++) {
                    const a1 = startAngle + i * angleStep;
                    const a2 = a1 + angleStep;
                    const largeArc = (a2 - a1) > Math.PI ? 1 : 0;

                    // 扇形格子
                    const x1 = cx + rOuter * Math.cos(a1), y1 = cy + rOuter * Math.sin(a1);
                    const x2 = cx + rOuter * Math.cos(a2), y2 = cy + rOuter * Math.sin(a2);
                    const x3 = cx + rInner * Math.cos(a2), y3 = cy + rInner * Math.sin(a2);
                    const x4 = cx + rInner * Math.cos(a1), y4 = cy + rInner * Math.sin(a1);
                    const path = `M ${x1},${y1} A ${rOuter},${rOuter} 0 ${largeArc} 1 ${x2},${y2} L ${x3},${y3} A ${rInner},${rInner} 0 ${largeArc} 0 ${x4},${y4} Z`;
                    const seg = document.createElementNS(svg.namespaceURI, "path");
                    seg.setAttribute("d", path);
                    seg.setAttribute("class", "segment");
                    svg.appendChild(seg);

                    // 价格标签（高→低）
                    const price = startPrice + (count - 1 - i);
                    const midA = (a1 + a2) / 2, midR = (rOuter + rInner) / 2;
                    const lx = cx + midR * Math.cos(midA), ly = cy + midR * Math.sin(midA);
                    const lbl = document.createElementNS(svg.namespaceURI, "text");
                    lbl.setAttribute("x", lx);
                    lbl.setAttribute("y", ly);
                    lbl.setAttribute("class", "label");
                    lbl.textContent = `￥${price}`;
                    svg.appendChild(lbl);

                    // Cell → Head
                    const startX = cx + rOuter * Math.cos(midA);
                    const startY = cy + rOuter * Math.sin(midA);
                    const headCX = startX + offset1 * Math.cos(midA);
                    const headCY = startY + offset1 * Math.sin(midA);
                    const headInX = headCX - nodeRadius * Math.cos(midA);
                    const headInY = headCY - nodeRadius * Math.sin(midA);
                    const p1 = document.createElementNS(svg.namespaceURI, "line");
                    p1.setAttribute("x1", startX);
                    p1.setAttribute("y1", startY);
                    p1.setAttribute("x2", headInX);
                    p1.setAttribute("y2", headInY);
                    p1.setAttribute("class", "pointer");
                    svg.appendChild(p1);

                    // Head
                    const hNode = document.createElementNS(svg.namespaceURI, "circle");
                    hNode.setAttribute("cx", headCX);
                    hNode.setAttribute("cy", headCY);
                    hNode.setAttribute("r", nodeRadius);
                    hNode.setAttribute("class", "dll-node");
                    svg.appendChild(hNode);
                    const hText = document.createElementNS(svg.namespaceURI, "text");
                    hText.setAttribute("x", headCX);
                    hText.setAttribute("y", headCY);
                    hText.setAttribute("class", "dll-text");
                    hText.textContent = "H";
                    svg.appendChild(hText);

                    // H → Mid
                    const midCX = headCX + h2mLen * Math.cos(midA);
                    const midCY = headCY + h2mLen * Math.sin(midA);
                    const midInX = midCX - nodeRadius * Math.cos(midA);
                    const midInY = midCY - nodeRadius * Math.sin(midA);
                    const midOutX = midCX + nodeRadius * Math.cos(midA);
                    const midOutY = midCY + nodeRadius * Math.sin(midA);
                    const p2a = document.createElementNS(svg.namespaceURI, "line");
                    p2a.setAttribute("x1", headCX + nodeRadius * Math.cos(midA));
                    p2a.setAttribute("y1", headCY + nodeRadius * Math.sin(midA));
                    p2a.setAttribute("x2", midInX);
                    p2a.setAttribute("y2", midInY);
                    p2a.setAttribute("class", "pointer");
                    svg.appendChild(p2a);
                    const mNode = document.createElementNS(svg.namespaceURI, "circle");
                    mNode.setAttribute("cx", midCX);
                    mNode.setAttribute("cy", midCY);
                    mNode.setAttribute("r", nodeRadius);
                    mNode.setAttribute("class", "dll-node");
                    svg.appendChild(mNode);
                    const mText = document.createElementNS(svg.namespaceURI, "text");
                    mText.setAttribute("x", midCX);
                    mText.setAttribute("y", midCY);
                    mText.setAttribute("class", "dll-text");
                    mText.textContent = "…";
                    svg.appendChild(mText);

                    // Mid → Tail
                    const tailCX = midCX + m2tLen * Math.cos(midA);
                    const tailCY = midCY + m2tLen * Math.sin(midA);
                    const tailInX = tailCX - nodeRadius * Math.cos(midA);
                    const tailInY = tailCY - nodeRadius * Math.sin(midA);
                    const p2b = document.createElementNS(svg.namespaceURI, "line");
                    p2b.setAttribute("x1", midOutX);
                    p2b.setAttribute("y1", midOutY);
                    p2b.setAttribute("x2", tailInX);
                    p2b.setAttribute("y2", tailInY);
                    p2b.setAttribute("class", "pointer");
                    svg.appendChild(p2b);
                    const tNode = document.createElementNS(svg.namespaceURI, "circle");
                    tNode.setAttribute("cx", tailCX);
                    tNode.setAttribute("cy", tailCY);
                    tNode.setAttribute("r", nodeRadius);
                    tNode.setAttribute("class", "dll-node");
                    svg.appendChild(tNode);
                    const tText = document.createElementNS(svg.namespaceURI, "text");
                    tText.setAttribute("x", tailCX);
                    tText.setAttribute("y", tailCY);
                    tText.setAttribute("class", "dll-text");
                    tText.textContent = "T";
                    svg.appendChild(tText);
                }
            })();
        </script>
    </g>
</svg>
</body>
</html>
